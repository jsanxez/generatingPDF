<!DOCTYPE html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8"> 
    <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js" integrity="sha512-ToRWKKOvhBSS8EtqSflysM/S7v9bB9V0X3B1+E7xo7XZBEZCPL3VX5SFIp8zxY19r7Sz0svqQVbAOx+QcLQSAQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js" integrity="sha512-V/C9Axb8EEL4ix79ERIJmpRd6Mp1rWVSxa2PIBCdCxqhEsfCBWp/R0xJ4U495czhcuDWrGOFYo8+QI3lJ9DK5g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
    <!-- <script "https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.es.min.js" integrity="sha512-c+saVKCDR1mMTnfidrSrxnA/ZCi4CihmvWfwvByrE+m48irr8SX43dfgF62xDJaQfVFj7opgYhJA8uzwQW8BXQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js" integrity="sha512-tVYBzEItJit9HXaWTPo8vveXlkK62LbA+wez9IgzjTmFNLMBO1BEYladBw2wnM3YURZSMUyhayPCoLtjGh84NQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
    <title>jsPDF</title> 
</head> 
 
<body> 

  <button onclick="downloadPdf()">Descargar PDF</button> 

<script>

// let content = document.getElementById("parrafo1").innerText;

let pageWidth        = 210;
let pageHeight       = 297;
let lineHeightFactor = 1.5;
let dpmm             = 2.834646;      // 72 dpi
let fontSize         = 12;     // set in pts 1pt = 0.3528mm
let margin           = 25.4;   // 2.54 cm = 1in
let maxLineWidth     = (pageWidth - margin * 2) + 10;

jsPDF.API.page            = 0;
jsPDF.API.headerSpacings  = {title: 0, subtitle: 0, paragraph: 0};
jsPDF.API.headerImages    = [];
jsPDF.API.addNewPage      = function(format, orientation) {
  this.addPage(format, orientation);
  posPointer = initialPos;
  this.page++;
  setPageHeaders(this.headerImages);
};

const doc = new jsPDF({orientation: "portrait", unit: "mm", lineHeight: lineHeightFactor});

// Drawing margin lines: 
// doc.setDrawColor(255, 255, 255);
doc.setDrawColor(0, 0, 0);
doc.line(margin, margin, margin + maxLineWidth, margin, 'F');
doc.line(margin, margin, margin, pageHeight - margin, 'F');
doc.line(margin+maxLineWidth, margin, margin+maxLineWidth, pageHeight - margin, 'F');
doc.line(margin, pageHeight-margin, margin + maxLineWidth, pageHeight-margin, 'F');

// Adding the text:
let titleSize           = 18;
let subtitleSize        = 12;
let paragraphSize       = 11;
doc.headerSpacings      = {title: 8, subtitle: 6, paragraph: 2};
doc.headerImages        = ["header1.png", "header2.png", "header3.png", "header4.png"];
let initialPos          = 70  // First position of the text
let posPointer          = initialPos;
let previousPagePointer = posPointer;


setText("title", "ANTECEDENTES");

let text2 = "PERULINUX SAC es una consultora de sistemas dedicada a brindar servicios en Software Libre para instituciones públicas y privadas, nos caracterizamos por ser una consultora independiente, que busca las mejores soluciones para su entorno, analizando las necesidades que su negocio y sus clientes necesitan.";

setText("subtitle", "Visión del producto o servicio:");
setText("paragraph", text2);

setText("subtitle", "Misión del producto o servicio:");
setText("paragraph", text2);

setText("subtitle", "Correo electrónico");
setText("paragraph", "jsanchez@gmail.com\njsanchez2@gmail.com");

setText("subtitle", "RUC o DNI");
setText("paragraph", "20507334165\n20600735668");

setText("subtitle", "Marca comercial o nombre completo");
setText("paragraph", "PERULINUX SAC\nPERULINUX NG SAC");


// setText("title", "MEDIOS DE COMUNICACION");
// setText("subtitle", "Producto o servicio");
// setText("paragraph", "Otro parrafo cortito pero al que se le puede agregar mas texto para poder desbordar nuevamente la pagina jeje, seguimos sin poder desbordarla, ahora agreguemos mas texto de lo que se tenia vete a la versh.");
setGroupedText({title: "MEDIOS DE COMUNICACION 2", subtitle: "Producto o servicio", paragraph: "Otro parrafo cortito pero al que se le puede agregar mas texto para poder desbordar nuevamente la pagina jeje, seguimos sin poder desbordarla, ahora agreguemos mas texto de lo que se tenia vete a la versh."});

// setLogo(18);
doc.addNewPage();
setText("title", "MEDIOS DE COMUNICACION");
setText("subtitle", "Producto o servicio");
setText("paragraph", "Otro parrafo cortito pero al que se le puede agregar mas texto para poder desbordar nuevamente la pagina jeje, seguimos sin poder desbordarla, ahora agreguemos mas texto de lo que se tenia vete a la versh.");



function setLogo(r) {
  doc.setFillColor(0, 0, 0);
  doc.circle(margin+maxLineWidth-r, posPointer - r - calcTextHeight(paragraphSize, 1), r, "F");
}

function setPageHeaders(imgPaths) {
  let actualPage = doc.page + 1;
  let i = doc.page % 4;

  // set first page header once:
  if(actualPage == 2) {
    setPageHeader(imgPaths[0], 'PNG', 1);
  }

  setPageHeader(imgPaths[i], 'PNG', actualPage);
}

function setPageHeader(imgpath, type='', page=doc.page+1) {
  if(imgpath == undefined) {
    throw TypeError("At least 1 argument required");
    return;
  }

  let img = new Image();

  img.src = imgpath;
  doc.setPage(page)
  doc.addImage(img, type, 0, 0, 210, 50);
}

function setGroupedText(texts) {
  let fits = false;
  let tmpPointer = posPointer;

  // evaluating whether the grouped text fits between the margins:
  for(prop in texts) {
    let wrappedText = doc.splitTextToSize(texts[prop], maxLineWidth);
    let textHeight  = calcTextHeight(prop, wrappedText.length);
    let oneLineHeight = textHeight / wrappedText.length;

    // if it's the first line, don't add the space:
    if(tmpPointer != initialPos)
      tmpPointer += doc.headerSpacings[prop];

    if(itFits(tmpPointer, textHeight, wrappedText.length)) {
      fits = true;
      tmpPointer += textHeight;

    } else {
      fits = false;
      break;
    }
  }

  if(fits) {
    for(prop in texts)
      setText(prop, texts[prop]);

  } else {
    doc.addNewPage();

    for(prop in texts)
      setText(prop, texts[prop]);
  }
}

function setText(textLevel, text) {
  setTextLevel(textLevel);
  let textArray     = doc.splitTextToSize(text, maxLineWidth);
  let textHeight    = calcTextHeight(textLevel, textArray.length);


  // if it's the first line, don't add the space:
  if(posPointer != initialPos)
    posPointer += doc.headerSpacings[textLevel];

  // if the text still fits between the margins:
  if(itFits(posPointer, textHeight, textArray.length)) {
    doc.text(textArray, margin, posPointer);
    posPointer += textHeight;
  } else {
    doc.addNewPage();
    doc.text(textArray, margin, posPointer);
    posPointer += textHeight;
  }
}

function itFits(pointer, textHeight, lines) {
  let oneLineHeight = textHeight / lines;

  return ((pointer + textHeight) - oneLineHeight <= pageHeight - margin) ? true : false;
}

function setTextLevel(textLevel) {
  doc.setFont("helvetica", "bold");
  doc.setTextColor(0, 0, 0);
  
  if(textLevel == "title")
    doc.setFontSize(titleSize);
  else if(textLevel == "subtitle")
    doc.setFontSize(subtitleSize);
  else if(textLevel == "paragraph") {
    doc.setFontSize(paragraphSize);
    doc.setFont("helvetica", "normal");
    doc.setTextColor(106, 104, 104);
  }
}

function calcTextHeight(fontSize, textLength) {
  if(typeof(fontSize) === "string") {
    switch(fontSize) {
      case "title":
        fontSize = titleSize;
        break;
      case "subtitle":
        fontSize = subtitleSize;
        break;
      case "paragraph":
        fontSize = paragraphSize;
        break;
      default:
        throw Error ("Invalid level of text");
    }
  }

  return (textLength * fontSize * lineHeightFactor) / dpmm;
}


function downloadPdf() {
  doc.save("output.pdf");
}

</script> 

</body> 
</html>